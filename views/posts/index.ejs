<%- include('../layouts/main', { title: title, user: user }) %>

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Georgia', serif;
        background-color: #f7f2e5;
        line-height: 1.6;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 40px;
    }

    .main-content {
        padding: 30px 0;
    }

    .header {
        margin-bottom: 30px;
    }

    .header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        color: #1a1a1a;
        margin-bottom: 8px;
    }

    .header p {
        color: #6b7280;
        font-size: 1rem;
    }

    .filter-tabs {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
        border-bottom: 1px solid #e5e7eb;
        padding-bottom: 10px;
    }

    .tab {
        padding: 8px 0;
        color: #6b7280;
        text-decoration: none;
        font-weight: 500;
        border-bottom: 2px solid transparent;
        transition: all 0.3s ease;
    }

    .tab.active {
        color: #1a1a1a;
        border-bottom-color: #3b82f6;
    }

    .tab:hover {
        color: #1a1a1a;
    }

    .article-grid {
        display: grid;
        gap: 30px;
    }

    .article-card {
        display: flex;
        gap: 20px;
        padding-bottom: 30px;
        border-bottom: 1px solid #f3f4f6;
    }

    .article-card:last-child {
        border-bottom: none;
        padding-bottom: 0;
    }

    .article-image {
        width: 200px;
        height: 140px;
        border-radius: 8px;
        object-fit: cover;
        flex-shrink: 0;
    }

    .article-content {
        flex: 1;
    }

    .article-meta {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
        font-size: 0.875rem;
        color: #6b7280;
    }

    .category-tag {
        background: #f3f4f6;
        padding: 4px 12px;
        border-radius: 20px;
        font-weight: 500;
        color: #374151;
    }

    .article-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 8px;
        line-height: 1.4;
    }

    .article-description {
        color: #6b7280;
        margin-bottom: 15px;
        line-height: 1.5;
    }

    .article-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .author-info {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .author-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: #e5e7eb;
    }

    .author-name {
        font-weight: 500;
        color: #374151;
        font-size: 0.875rem;
    }

    .article-stats {
        display: flex;
        gap: 15px;
        font-size: 0.875rem;
        color: #6b7280;
    }

    .sidebar {
        display: flex;
        flex-direction: column;
        gap: 30px;
    }

    .sidebar-section {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 25px;
    }

    .sidebar-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 20px;
    }

    .topic-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #f3f4f6;
    }

    .topic-item:last-child {
        border-bottom: none;
    }

    .topic-name {
        color: #374151;
        font-weight: 500;
    }

    .topic-count {
        color: #6b7280;
        font-size: 0.875rem;
    }

    .see-more {
        color: #f59e0b;
        text-decoration: none;
        font-weight: 500;
        font-size: 0.875rem;
        margin-top: 10px;
        display: inline-block;
    }

    .writer-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #f3f4f6;
    }

    .writer-item:last-child {
        border-bottom: none;
    }

    .writer-info {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .writer-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #e5e7eb;
    }

    .writer-details h4 {
        font-weight: 500;
        color: #374151;
        font-size: 0.9rem;
    }

    .writer-details p {
        color: #6b7280;
        font-size: 0.8rem;
    }

    .follow-btn {
        background: #1a1a1a;
        color: white;
        border: none;
        padding: 6px 16px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        cursor: pointer;
    }

    .premium-section {
        background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
        color: white;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    .premium-icon {
        font-size: 2rem;
        margin-bottom: 15px;
    }

    .premium-title {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 10px;
        color: white;
    }

    .premium-description {
        font-size: 0.9rem;
        opacity: 0.9;
        margin-bottom: 20px;
        line-height: 1.5;
    }

    .premium-btn {
        background: #f59e0b;
        color: #1a1a1a;
        border: none;
        padding: 12px 24px;
        border-radius: 25px;
        font-weight: 600;
        cursor: pointer;
        width: 100%;
    }

    @media (max-width: 768px) {
        .container {
            grid-template-columns: 1fr;
            gap: 20px;
            padding: 10px;
        }

        .article-card {
            flex-direction: column;
        }

        .article-image {
            width: 100%;
            height: 200px;
        }
    }
</style>

<div class="container">
    <main class="main-content">
        <div class="header">
            <h1>Artikel & Kegiatan</h1>
            <p>Temukan berbagai artikel edukasi dan dokumentasi kegiatan terbaru</p>
        </div>

        <nav class="filter-tabs">
            <a href="/posts?type=all" class="tab <%= typeof type === 'undefined' || type === 'all' ? 'active' : '' %>">Semua</a>
            <a href="/posts?type=article" class="tab <%= type === 'article' ? 'active' : '' %>">Artikel</a>
            <a href="/posts?type=activity" class="tab <%= type === 'activity' ? 'active' : '' %>">Kegiatan</a>
        </nav>

        <div class="article-grid">
            <% if ((articles && articles.length > 0) || (posts && posts.length > 0)) { %>
                <% 
                    // Combine articles and posts into a single array
                    let combinedItems = [];
                    
                    if (typeof articles !== 'undefined' && articles && articles.length > 0) {
                        articles.forEach(article => {
                            combinedItems.push({
                                ...article,
                                type: 'article',
                                date: article.created_at,
                                view_count: article.view_count || 0,
                                like_count: article.like_count || 0,
                                comment_count: article.comment_count || 0
                            });
                        });
                    }
                    
                    if (typeof posts !== 'undefined' && posts && posts.length > 0) {
                        posts.forEach(post => {
                            combinedItems.push({
                                ...post,
                                type: 'activity',
                                date: post.activity_date || post.created_at,
                                view_count: post.view_count || 0,
                                like_count: post.like_count || 0,
                                comment_count: post.comment_count || 0
                            });
                        });
                    }
                    
                    // Sort by date (newest first)
                    combinedItems.sort((a, b) => new Date(b.date) - new Date(a.date));
                %>
                
                <% combinedItems.forEach(item => { %>
                    <article class="article-card">
                        <% if (item.featured_image) { %>
                            <img src="<%= item.featured_image %>" alt="<%= item.title %>" class="article-image">
                        <% } else { %>
                            <div class="article-image" style="background: linear-gradient(45deg, #f3f4f6, #e5e7eb); display: flex; align-items: center; justify-content: center; color: #9ca3af;">
                                <i class="fas <%= item.type === 'article' ? 'fa-newspaper' : 'fa-calendar-alt' %>" style="font-size: 2rem;"></i>
                            </div>
                        <% } %>
                        <div class="article-content">
                            <div class="article-meta">
                                <span><%= new Date(item.date).toLocaleDateString('id-ID') %></span>
                                <span class="category-tag"><%= item.category_name || (item.type === 'article' ? 'Artikel' : 'Kegiatan') %></span>
                                <span class="category-tag <%= item.type === 'article' ? 'bg-success' : 'bg-info' %>">
                                    <%= item.type === 'article' ? 'Artikel' : 'Kegiatan' %>
                                </span>
                            </div>
                            <h2 class="article-title"><%= item.title %></h2>
                            <p class="article-description">
                                <%= item.excerpt ? item.excerpt.substring(0, 120) + '...' : 'Tidak ada deskripsi tersedia' %>
                            </p>
                            <div class="article-footer">
                                <div class="author-info">
                                    <% if (item.author_avatar) { %>
                                        <img src="<%= item.author_avatar %>" alt="<%= item.author_name %>" class="author-avatar">
                                    <% } else { %>
                                        <div class="author-avatar"></div>
                                    <% } %>
                                    <span class="author-name"><%= item.author_name || 'Admin' %></span>
                                </div>
                                <div class="article-stats">
                                    <span>❤️ <%= item.like_count || 0 %>k</span>
                                    <span>💬 <%= item.comment_count || 0 %>k</span>
                                </div>
                            </div>
                        </div>
                    </article>
                <% }); %>
            <% } else { %>
                <div class="col-12 text-center py-5">
                    <div class="empty-state">
                        <i class="fas fa-newspaper fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">Belum ada artikel atau kegiatan</h5>
                        <p class="text-muted">Artikel dan kegiatan akan muncul di sini</p>
                    </div>
                </div>
            <% } %>
        </div>
    </main>

    <aside class="sidebar">
        <div class="sidebar-section">
            <h3 class="sidebar-title">Kategori Populer</h3>
            <div class="topic-item">
                <span class="topic-name"># Pendidikan</span>
                <span class="topic-count">150 artikel</span>
            </div>
            <div class="topic-item">
                <span class="topic-name"># Teknologi</span>
                <span class="topic-count">95 artikel</span>
            </div>
            <div class="topic-item">
                <span class="topic-name"># Kegiatan Sekolah</span>
                <span class="topic-count">42 kegiatan</span>
            </div>
            <div class="topic-item">
                <span class="topic-name"># Pelatihan</span>
                <span class="topic-count">28 artikel</span>
            </div>
            <a href="#" class="see-more">Lihat semua kategori</a>
        </div>

        <div class="sidebar-section">
            <h3 class="sidebar-title">Penulis Terbaik</h3>
            <div class="writer-item">
                <div class="writer-info">
                    <div class="writer-avatar"></div>
                    <div class="writer-details">
                        <h4>Dr. Ahmad Rifai</h4>
                        <p>Pendidik</p>
                    </div>
                </div>
                <button class="follow-btn">Ikuti</button>
            </div>
            <div class="writer-item">
                <div class="writer-info">
                    <div class="writer-avatar"></div>
                    <div class="writer-details">
                        <h4>Siti Nurhaliza</h4>
                        <p>Jurnalis</p>
                    </div>
                </div>
                <button class="follow-btn">Ikuti</button>
            </div>
            <div class="writer-item">
                <div class="writer-info">
                    <div class="writer-avatar"></div>
                    <div class="writer-details">
                        <h4>Budi Santoso</h4>
                        <p>Peneliti</p>
                    </div>
                </div>
                <button class="follow-btn">Ikuti</button>
            </div>
            <div class="writer-item">
                <div class="writer-info">
                    <div class="writer-avatar"></div>
                    <div class="writer-details">
                        <h4>Rina Permata</h4>
                        <p>Editor</p>
                    </div>
                </div>
                <button class="follow-btn">Ikuti</button>
            </div>
            <a href="#" class="see-more">Lihat lebih banyak</a>
        </div>

        <div class="sidebar-section premium-section">
            <div class="premium-icon">⭐</div>
            <h3 class="premium-title">Jadi Member Premium</h3>
            <p class="premium-description">Akses konten eksklusif, artikel mendalam, dan pengalaman membaca tanpa iklan dengan menjadi Member Premium.</p>
            <button class="premium-btn">Lihat Semua Paket</button>
        </div>
    </aside>
</div>

<%- include('../layouts/footer') %>